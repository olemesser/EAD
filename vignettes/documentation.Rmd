---
title: "Programm Flowchart"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{test}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: references.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>"
)
```

## EAD Creation Process

![General Process for EAD Generation](images/ead_flow.svg){width="200"}

Before we go through the code step-by-step we load the library and set the seed.

```{r, include=T}
library(EAD)
set.seed(1234)
```

## 1.1 Create Product Mix

### Input

+------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Variable   | Description                                                                                                                                                                      | low values                                                                                                       | high values                                                                                                                                                                                                    |
+============+==================================================================================================================================================================================+==================================================================================================================+================================================================================================================================================================================================================+
| PARAM      | Parameter which is used differently across individual method~PM~.\                                                                                                               | `method="random"`: small product mix.                                                                            | `method="random"`: product mix is larger as many products are selected.\                                                                                                                                       |
|            | `method="random"`: defines the proportion of products within the product mix.\                                                                                                   |                                                                                                                  | `method="combination"`: product mix is constrained and, therefore, less products are offered (small product mix). `method="density"`: majority of products have many features selected (dense product matrix). |
|            | `method="combination"`: defines the proportion of entries within the product mix constraining matrix DSM~FD~. `method="density"`: defines the density of the later P~FD~ matrix. | `method="combination"`: No constraints on functional requirements combination resulting in a large product mix.\ |                                                                                                                                                                                                                |
|            |                                                                                                                                                                                  | `method="density"`: majority of products have only some features selected (sparse product matrix)                |                                                                                                                                                                                                                |
+------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| method     | Method for generating the product mix. Depending on the method PARAM has different meanings.                                                                                     |                                                                                                                  |                                                                                                                                                                                                                |
+------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| N_FR       | Number of elements in the functional domain                                                                                                                                      | Only a few functional requirements necessary to realize the product mix.                                         | Many functional requirements necessary to realize the product mix.                                                                                                                                             |
+------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### Generation Process

The product mix is generated by three input parameters. The number of functional requirements (*N_FR*); the generation parameter (*PARAM*) where its interpretation depends on the creation method (*method*). In a first step, the power set of functional requirements is generated; and the empty product (all zeros) is excluded. This results in a binary matrix where for each product (rows) the functional requirements are defined (see equations (2.12) and (2.13)). In a second step, the free product mix is restricted using one of the following methods. The user can choose between the *"random", "combination"* and "*density"*. If *"combination"* is selected, the product mix is constrained by replacing *PARAM* percentage of entries in the product mix constraint matrix (DSM_FD) with a randomly generated constraint. The *"random"* method samples *PARAM* percentage of products randomly from the product mix. If "*density"* is chosen, products are selected in a way which ensures that the final product matrix (P_FD) shows a certain density (proportion of none-zero entries).

While the combination method refers to industrial procedure of restricting feature combinations, the *"density"* method allows to reproduce empirical observed product mixes. Finally, the *"random"* method has the advantage that the number of products can be directly influenced. This is important in cases where a fixed number of products is desired. Regardless the method, the procedure ensures, that each functional requirement is used at least ones (no zero columns).

### Example

Let's assume that we have four functional requirements which result in 15 products under free combination.

```{r,include=TRUE,eval=F}
## Create a Product Mix, where 20% of the total products
P_FD<-create_ProductMix(N_FR=4,PARAM=0.2,method="random")

P_FD$P_FD_const # returns the constraint product maxtrix

P_FD$measures # returns the measures
```

## 1.2 Create Product Demand

### Input

+-------------+----------------------------------------------------+------------------------------------------------+-------------------------------------------------------------------------------+
| Variable    | Description                                        | low values                                     | high values                                                                   |
+=============+====================================================+================================================+===============================================================================+
| DMD_cv      | Coefficient of variation for the demand vector.    | Sales are equally distributed across products. | Some products with a high share on sales and many products with low quantity. |
+-------------+----------------------------------------------------+------------------------------------------------+-------------------------------------------------------------------------------+
| TD          | Total number of sales for the created product mix. | Product mix with low number of total sales.    | Product mix with high number of total sales.                                  |
+-------------+----------------------------------------------------+------------------------------------------------+-------------------------------------------------------------------------------+

### Generation Process

Following the Anand model, product demand is assumed to be given exogenously. A product demand vector, therefore, varies in three dimensions. The number of products which are specified by the current product mix and generated in the previous step; the total demand (*TD*) defined as the number of units sold from the product mix; and distribution of sales across products (*DMD_cv*). Demand distribution can be influenced by an input coefficient of variation. The procedure generates vector of random integers which fulfills two criteria. First, the sum of entries must be equal the total demand and, second, the achieved coefficient of variation must lie between a ten percent interval of the supplied input value. Depending on the input parameters, for some combinations there exist no valid solution. In such cases, the procedure stops after ten iterations and the current vector which represents the nearest possible solution is returned.

### Example

Create a demand vector with 120 products, a total demand of 1000 units and a coefficient of variation of 2.

```{r, include=TRUE}
DMD<-crt_DEMAND(n_PROD=120,TOTAL_DEMAND=1000,cv=1)

DMD$DEMAND # demand vector

DMD$CHECK # demand measures
```

## Create Domains

The sub flowchart of the `crt_DOMAINS` function is shown below.

![Flowchart for the domain creation process](images/crt_DOMAINS.svg){width="200"}

The procedure is exemplary shown for one domain transition. Source domain elements are noted with the indices `src` and the target domain elements with the `tgt` indices. A domain transition consists of an inter-domain matrix $DMM_{src,tgt}$ as well as a dependency structure matrix ($DMM_{tgt}$) and is defined as:

$$
P_{tgt}=P_{src}*[(DMM_{src,tgt}*DSM_{tgt})+DMM_{src,tgt}]
$$

$P_{src}$ is the product representation in the source domain and $P_{tgt}$ in the target domain. The mapping between physical domain (PD) and process domain (PrD) as well as between PrD and resource domain (RD) are defined shown in the equation above. The mapping between functional domain (FD) and PD is an exception and is defined as:

$$
P_{PD}=max_{el}(P_{PD,1ij};P_{PD,2ij})
$$

Where $max_{el}$ is the element wise maximum of the two product matrices which are defined as:

$$
\begin{equation*}
P_{PD,1} = \begin{cases}
1 &P_{FD}*DMM_{FD,PD}>0\\
0 &\text{else}
\end{cases}
\end{equation*}
$$

and:

$$
P_{PD,2}=P_{PD,1}*DSM_{PD}
$$

### 2.1-4 Create DMM

#### Input

The following table shows the main input variables for the domain mapping matrix generation. `upper_Bound` and `binary` are not shown here. For a detailed describes see documentation of `?crt_DMM()`

+-------------+----------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------+
| Variable    | Description                                                                                                                                  | low values                                   | high values                         |
+=============+==============================================================================================================================================+==============================================+=====================================+
| N_src       | Number of source elements, rows of the later DMM matrix.                                                                                     | Small number of source elements.             | Large number of source elements.    |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------+
| N_tgt       | Number of target elements, columns of the later DMM matrix.                                                                                  | Small number of target elements.             | Large number of target elements.    |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------+
| DMM_PAR     | Specifies either the system design complexity which should be generated `method="SDC"` or the percentage of non-zero entries `method="DENS"` | An uncoupled design matrix (diagonal matrix) | A (strongly) coupled design matrix. |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------+
| method      | Method for pattern generation.                                                                                                               |                                              |                                     |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------+
| upper_Bound | Upper bound of an integer uniform distribution for integer sampling.                                                                         | Small heterogeneity in design.               | Large heterogeneity in design.      |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+-------------------------------------+

#### Generation Process

In a first step of the domain generation process, the inter-domain matrix $DMM_{src,tgt}$ is created by five user-specified input parameters as shown in the following table above. The first two parameters define the dimensions of $DMM_{src,tgt}$ , where $N_{src}$ refers to the number of rows and $N_{tgt}$ to the number of columns. Therefore, all DMMs are directed matrices where the required elements (columns) for each source element (rows) are defined. `DMM_PAR` is the main design parameter to decide which values are none zero. This variable is treated as a desired system design complexity ($SDC$). For more details on this measures see: `?measure_designComplexity()` and [@modrak2015]. Starting with a randomly generated binary matrix, an optimization tries to reach the user-supplied SDC-value ($0\leq SDC\leq 1$). Small values of $SDC$ refer to a more uncoupled design where larger values result in a more coupled design. In a last step, a post sampling is performed. The framework allows to generate non-binary DMMs. In doing so the default value of `upper_Bound` is increased. An increasing of `upper_Bound` results in more heterogeneity within $DMM_{src,tgt}$. Product family design complexity, therefore, increases with increasing `DMM_PAR` and `upper_Bound` values. Large values of `DMM_PAR` are hypothetical possible, however, the framework does not produce matrices with large `DMM_PAR` if `upper_Bound=1`. The reason is that at the end of the generation procedure it is ensured that each product (rows) in $P_{tgt}$ is unique unique condition). Additionally, it is ensured that each target element is used by at least one product (none zero condition).

#### Example

```{r, include=TRUE}
DMM<-crt_DMM(N_src=5,
             N_tgt=10,
             method="SDC",
             DMM_PAR=0.2,
             upper_Bound=4)

DMM$DMM # returns the DMM matrix

DMM$SDC # returns the actual SDC value
```

### 2.6 Create DSM

## References
